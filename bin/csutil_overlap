#!/usr/bin/env perl

use strict;
use warnings;

use FindBin;
use lib "$FindBin::Bin";
use lib "$FindBin::Bin/../lib/perl";
use lib "$FindBin::Bin/../lib/perl/site-perl";

use Change::Util::InterfaceSCM  qw/getOverlappedCsidsSCM/;
use SCM::Util                   qw/isValidMoveType/;

die usage() if not @ARGV;

my $move = isValidMoveType($ARGV[0]) or do {
    warn "$ARGV[0]: Not a valid movetype\n";
    die usage();
};

my $overlap = getOverlappedCsidsSCM($move, @ARGV[1..$#ARGV]) or
  die "error retrieving overlap: $!.".$/;

while (my ($csid, $info) = each(%$overlap)) {
  print "$csid: ".$/;
  print join $/, map { "  $_: $info->{$_}" } keys %$info;
  print $/;
}

sub usage {
    return <<EOUSAGE;
$0: get CSIDs with overlapping files from staging area
Usage: $0 <movetype> lroot1 lroot2 ...
EOUSAGE
}

